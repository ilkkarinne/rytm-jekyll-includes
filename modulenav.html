{%- if include.module -%}
<div class="modulenav">
  <nav class="navbar navbar-expand-md navbar-light">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".modulenav-toggleable" aria-controls="moduleNavBar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse flex-column align-items-start modulenav-toggleable" id="moduleNavBar">
      <div class="nav-heading">
        <div class="moduletitle">{{ include.module.title }}</div>
        {%- if current_module_version -%}
        <div class="btn-group dropleft">
            <button type="button" class="btn btn-light dropdown-toggle" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                Versio {{ current_module_version.id }}
            </button>
            <div class="dropdown-menu">
                <span class="dropdown-header">Saatavilla olevat versiot</span>
                {%- assign my_ver = '/' | append: current_module_version.path | append: '/' -%}
                {%- for version in include.module.versions -%}
                {%- assign other_ver = '/' | append: version.path | append: '/' -%}
                <a class="dropdown-item" href="{{ site.url }}{{ page.url | replace: my_ver, other_ver }}" title="{{ version.date | date: '%d.%m.%Y' }}">{{ version.id }}:&nbsp;{{ version.title }}</a>
                {%- endfor -%}
            </div>
        </div>
          {%- assign basepath = include.module.basepath | append: "/" | append: current_module_version.path -%}
        {%- else -%}
          {%- assign basepath = include.module.basepath -%}
        {%- endif -%}
      </div>
      <ul class="nav flex-column align-items-start">
        {%- for item in include.module.nav_items -%}
          {%- capture path %}{%- include common/getNavItemPath.html item=item -%}{%- endcapture -%}
          {%- if item.heading -%}
          <li class="nav-item header">
            <span>{{ item.title }}</span>
          </li>
          {%- else -%}
            {%- assign to_match = include.module.basepath | append: '-' | append: item.id -%}
            {%- if pageId == to_match -%}
              {%- assign item_class = "active" -%}
            {%- else -%}
              {%- assign item_class = "" -%}
            {%- endif -%}
          <li class="nav-item {{item_class}}">
            <a class="nav-link" href="{{ site.url }}/{{ basepath }}/{{ path }}">{{ item.title }}</a>
          </li>
          {%- endif -%}
          </li>
          {%- for subitem in item.subitems -%}
            {%- assign to_match = include.module.basepath | append: '-' | append: subitem.id -%}
            {%- if pageId == to_match -%}
              {%- assign item_class = "active" -%}
            {%- else -%}
              {%- assign item_class = "" -%}
            {%- endif -%}
            {%- capture subpath -%}{%- include common/getNavItemPath.html item=subitem -%}{%- endcapture -%}
          <li class="nav-item {{item_class}}">
            <a class="nav-link sublevel" href="{{ site.url }}/{{ basepath}}/{{ path }}{{ subpath }}">{{ subitem.title }}</a></li>
          </li>
          {%- endfor -%}
        {%- endfor -%}
      </ul>
    </div>
    <div class="vertical-heading collapse modulenav-toggleable navbar-expand-md show">
      <div class="moduletitle">{{ include.module.title }} &mdash; {{ current_module_version.id }}</div>
    </div>
  </nav>
</div>
{%- endif -%}
